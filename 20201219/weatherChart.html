<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
</head>



<body>
  <canvas id="lokiChart" width="1200" height="300"></canvas>
  <script>
    let test = null;
    // let kl = null, tp = null, nt = null, tu = null;
    $.getJSON("https://opendata.cwb.gov.tw/fileapi/v1/opendataapi/F-D0047-091?Authorization=CWB-77F7EF76-6578-458C-ACDF-72ABF4BE7727&downloadType=WEB&format=JSON")
      .done(function (re) {
        //簡化四個縣市的節點，方便取得
        const kl = re.cwbopendata.dataset.locations.location[13];
        const tp = re.cwbopendata.dataset.locations.location[16];
        const nt = re.cwbopendata.dataset.locations.location[18];
        const tu = re.cwbopendata.dataset.locations.location[21];

        // 變數初始化
        let dateLabels = new Array(); //塞X軸之標題(時間labels)
        let klVal = new Array(), tpVal = new Array(), ntVal = new Array(), tuVal = new Array(); //塞四個縣市的Y軸之數據(溫度值)

        for (let i = 0; i < nt.weatherElement[0].time.length; i++) {
          // console.log(nt.weatherElement[0].time[i].startTime);
          //dateLabels[i] = nt.weatherElement[0].time[i].startTime;//從某一縣市取得所有time之時間字串指定給Labels陣列
          dateLabels[i] = nt.weatherElement[0].time[i].startTime.substr(0, 13);

          // array.push(value)  四個縣市的溫度值之資料陣列
          ntVal.push(nt.weatherElement[0].time[i].elementValue.value);
          tpVal.push(tp.weatherElement[0].time[i].elementValue.value);
          klVal.push(kl.weatherElement[0].time[i].elementValue.value);
          tuVal.push(tu.weatherElement[0].time[i].elementValue.value);
        }
        // console.log(ntVal,tpVal,klVal,tuVal);

        let findmin=Math.min(Math.min(...ntVal),Math.min(...tpVal),Math.min(...klVal),Math.min(...tuVal));
        let findmax=Math.max(Math.max(...ntVal),Math.max(...tpVal),Math.max(...klVal),Math.max(...tuVal));

        //chart.js 繪圖
        let ctx = $("#lokiChart");
        new Chart(ctx, {
          type: 'line',//你要的類型
          data: {
            labels: dateLabels,//各x資料標題(陣列) 
            datasets: [{ //資料內容的各項參數，以陣列來設定多筆 [{...},{...},{...},{...}]
              label: nt.locationName,
              data: ntVal, //y值
              // backgroundColor: 'rgba(255, 200, 50, 0.2)',//y值背景色
              fill:false,
              borderColor: 'rgba(255, 99, 132, 1)',//y值邊框色，
              borderWidth: 3//y值邊框色
            }, {
              label: kl.locationName,
              data: klVal, //y值
              // backgroundColor: 'rgba(54, 162, 235, 0.2)',
              fill:false,
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 3
            }, {
              label: tp.locationName,
              data: tpVal, //y值
              // backgroundColor: 'rgba(255, 206, 86, 0.2)',
              fill:false,
              borderColor: 'rgba(255, 206, 86, 1)',
              borderWidth: 3
            }, {
              label: tu.locationName,
              data: tuVal, //y值
              // backgroundColor: 'rgba(75, 192, 192, 0.2)',
              fill:false,
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 3
            }]
          },
          options: { //基本設定
            scales: {
              yAxes: [{
                ticks: {
                  // beginAtZero: true
                  min: findmin-2,
                  max: findmax+2,
                  stepSize: 0.5
                }
              }]
            }
          }
        });



      }).fail(function (re) {
        console.log("api連線失敗！");
      });







  </script>
</body>

</html>