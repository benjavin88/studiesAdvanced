<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
</head>



<body>
  <canvas id="dayChart" width="1200" height="300"></canvas>
  <canvas id="nightChart" width="1200" height="300" style="background: #3333;"></canvas>
  <script>
    $.getJSON("https://opendata.cwb.gov.tw/fileapi/v1/opendataapi/F-D0047-091?Authorization=CWB-77F7EF76-6578-458C-ACDF-72ABF4BE7727&downloadType=WEB&format=JSON")
      .done(function (re) {
        const kl = re.cwbopendata.dataset.locations.location[13];
        const tp = re.cwbopendata.dataset.locations.location[16];
        const nt = re.cwbopendata.dataset.locations.location[18];
        const tu = re.cwbopendata.dataset.locations.location[21];
        let
          dayLabels = new Array(),
          nightLabels = new Array();
        let
          klValD = new Array(), tpValD = new Array(), ntValD = new Array(), tuValD = new Array(),
          klValN = new Array(), tpValN = new Array(), ntValN = new Array(), tuValN = new Array();
        for (let i = 0; i < nt.weatherElement[0].time.length; i++) {
          const chk = nt.weatherElement[0].time[i].startTime.substr(11, 2);
          if (chk != 18) {
            dayLabels.push(nt.weatherElement[0].time[i].startTime.substr(0, 13));
            ntValD.push(nt.weatherElement[0].time[i].elementValue.value);
            tpValD.push(tp.weatherElement[0].time[i].elementValue.value);
            klValD.push(kl.weatherElement[0].time[i].elementValue.value);
            tuValD.push(tu.weatherElement[0].time[i].elementValue.value);
          }
          else {
            nightLabels.push(nt.weatherElement[0].time[i].startTime.substr(0, 13));
            ntValN.push(nt.weatherElement[0].time[i].elementValue.value);
            tpValN.push(tp.weatherElement[0].time[i].elementValue.value);
            klValN.push(kl.weatherElement[0].time[i].elementValue.value);
            tuValN.push(tu.weatherElement[0].time[i].elementValue.value);
          }
        }
        let
          findminD = Math.min(Math.min(...ntValD), Math.min(...tpValD), Math.min(...klValD), Math.min(...tuValD)),
          findmaxD = Math.max(Math.max(...ntValD), Math.max(...tpValD), Math.max(...klValD), Math.max(...tuValD)),
          findminN = Math.min(Math.min(...ntValN), Math.min(...tpValN), Math.min(...klValN), Math.min(...tuValN)),
          findmaxN = Math.max(Math.max(...ntValN), Math.max(...tpValN), Math.max(...klValN), Math.max(...tuValN));
        new Chart($("#dayChart"), {
          type: 'line',
          data: {
            labels: dayLabels,
            datasets: [{
              label: nt.locationName,
              data: ntValD,
              fill: false,
              borderColor: 'rgba(255, 99, 132, 1)',
              borderWidth: 3
            }, {
              label: kl.locationName,
              data: klValD,
              fill: false,
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 3
            }, {
              label: tp.locationName,
              data: tpValD,
              fill: false,
              borderColor: 'rgba(255, 206, 86, 1)',
              borderWidth: 3
            }, {
              label: tu.locationName,
              data: tuValD,
              fill: false,
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 3
            }]
          },
          options: {
            scales: {
              yAxes: [{
                ticks: {
                  min: findminD - 2,
                  max: findmaxD + 2,
                  stepSize: 0.5
                }
              }]
            }
          }
        });
        new Chart($("#nightChart"), {
          type: 'line',
          data: {
            labels: nightLabels,
            datasets: [{
              label: nt.locationName,
              data: ntValN,
              fill: false,
              borderColor: 'rgba(255, 99, 132, 1)',
              borderWidth: 3
            }, {
              label: kl.locationName,
              data: klValN,
              fill: false,
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 3
            }, {
              label: tp.locationName,
              data: tpValN,
              fill: false,
              borderColor: 'rgba(255, 206, 86, 1)',
              borderWidth: 3
            }, {
              label: tu.locationName,
              data: tuValN,
              fill: false,
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 3
            }]
          },
          options: {
            scales: {
              yAxes: [{
                ticks: {
                  min: findminN - 2,
                  max: findmaxN + 2,
                  stepSize: 0.5
                }
              }]
            }
          }
        });
      }).fail(function (re) {
        console.log("api連線失敗！");
      });
  </script>
</body>

</html>